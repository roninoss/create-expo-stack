import { ScreenContent } from 'components/ScreenContent';
import { StatusBar } from 'expo-status-bar';

<% if (props.authenticationPackage?.name === "clerk") { %>
  import * as SecureStore from 'expo-secure-store'
  import { ClerkLoaded, ClerkProvider } from '@clerk/clerk-expo';
<% } %>

<% if (props.internalizationPackage?.name === "i18next") { %>
  import './translation';
  import { InternalizationExample } from 'components/InternalizationExample';
<% } %>

<% if (props.stylingPackage?.name === "nativewind") { %>
  import './global.css';
<% } else if (props.stylingPackage?.name === "nativewinui") { %>
  import './global.css';
  import 'expo-dev-client';
<% } else if (props.stylingPackage?.name === "restyle") { %>
  import { ThemeProvider } from '@shopify/restyle';
  import { theme } from 'theme';
<% } else if (props.stylingPackage?.name === "tamagui") { %>
  <% if (!props.internalizationPackage) { %>
    import { Text } from 'react-native';
  <% } %>
  import { TamaguiProvider } from 'tamagui';
  import config from './tamagui.config';
<% } %>

<% if (props.analyticsPackage?.name === "vexo-analytics") { %>
  import { vexo } from 'vexo-analytics';

  vexo(process.env.EXPO_PUBLIC_VEXO_API_KEY);
<% } %>

export default function App() {   
<% if (props.authenticationPackage?.name === "clerk") { %>
  const tokenCache = {
    async getToken(key: string) {
      try {
        const item = await SecureStore.getItemAsync(key)
        if (item) {
          console.log(`${key} was used üîê \n`)
        } else {
          console.log('No values stored under key: ' + key)
        }
        return item
      } catch (error) {
        console.error('SecureStore get item error: ', error)
        await SecureStore.deleteItemAsync(key)
        return null
      }
    },
    async saveToken(key: string, value: string) {
      try {
        return SecureStore.setItemAsync(key, value)
      } catch (err) {
        return
      }
    },
  }

  const clerkPublishableKey = process.env.EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY;
  if (!clerkPublishableKey) {
    throw new Error('Missing EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY, add one in your .env file');
  }
<% } %>

  return (
<% if (props.authenticationPackage?.name === "clerk") { %>
    <ClerkProvider tokenCache={tokenCache} publishableKey={clerkPublishableKey}>
      <ClerkLoaded>
<% } else { %>
    <>
<% } %>
<% if (props.stylingPackage?.name === "restyle") {%>
        <ThemeProvider theme={theme}>
          <ScreenContent title="Home" path="App.tsx">
          <% if (props.internalizationPackage?.name === "i18next") { %>
            <InternalizationExample />
          <% } %>
          </ScreenContent>
          <StatusBar style="auto" />
        </ThemeProvider>
<% } else if (props.stylingPackage?.name === "tamagui") {%>
        <TamaguiProvider config={config}>
          <ScreenContent title="Home" path="App.tsx">
          <% if (props.internalizationPackage?.name === "i18next") { %>
            <InternalizationExample />
          <% } else { %>
            <Text>Open up App.tsx to start working on your app!</Text>
          <% } %>
          </ScreenContent>
          <StatusBar style="auto" />
        </TamaguiProvider>
<% } else { %>
        <ScreenContent title="Home" path="App.tsx">
        <% if (props.internalizationPackage?.name === "i18next") { %>
          <InternalizationExample />
        <% } %>
        </ScreenContent>
        <StatusBar style="auto" />
<% } %>
<% if (props.authenticationPackage?.name === "clerk") { %>
      </ClerkLoaded>
    </ClerkProvider>
<% } else { %>
    </>
<% } %>
  );
}